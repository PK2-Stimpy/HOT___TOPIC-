package me.ionar.salhack.module.exploit;

import net.minecraft.client.Minecraft;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;

import static net.minecraft.network.play.client.CPacketEntityAction.Action.START_SPRINTING;
import static net.minecraft.network.play.client.CPacketEntityAction.Action.STOP_SPRINTING;

import me.ionar.salhack.events.network.EventNetworkPacketEvent;
import me.ionar.salhack.module.Module;
import me.ionar.salhack.module.Value;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;

public final class AntiHungerModule extends Module
{
    public final Value<Boolean> Sprint = new Value("Sprint", new String[]
    { "Sprint" }, "Cancel out the sprinting packets", false);
    public final Value<Boolean> Ground = new Value("Ground", new String[]
    { "Ground" }, "Spoofs onground state for movement packets", true);

    public AntiHungerModule()
    {
        super("AntiHunger", new String[]
        { "NoHunger" }, "Prevents hunger loss by spoofing on ground state", "NONE", 0xDB24AB, ModuleType.EXPLOIT);
    }

    @EventHandler
    private Listener<EventNetworkPacketEvent> PacketEvent = new Listener<>(p_Event ->
    {
        if (p_Event.getPacket() instanceof CPacketPlayer && Ground.getValue() && !mc.player.isElytraFlying())
        {
            final CPacketPlayer l_Packet = (CPacketPlayer) p_Event.getPacket();
            if (mc.player.fallDistance > 0 || mc.playerController.isHittingBlock)
            {
                l_Packet.onGround = true;
            }
            else
            {
                l_Packet.onGround = false;
            }
        }
        
        if (p_Event.getPacket() instanceof CPacketEntityAction && Sprint.getValue())
        {
            final CPacketEntityAction l_Packet = (CPacketEntityAction) p_Event.getPacket();
            if (l_Packet.getAction() == START_SPRINTING || l_Packet.getAction() == STOP_SPRINTING)
            {
                p_Event.cancel();
            }
        }
    });

}
