package me.ionar.salhack.module.exploit;

import java.util.ArrayList;

import me.ionar.salhack.events.network.EventNetworkPacketEvent;
import me.ionar.salhack.module.Module;
import me.ionar.salhack.module.Value;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.*;

public final class PacketCancellerModule extends Module
{
    public final Value<Boolean> CancelCPacketInput = new Value<Boolean>("Input", new String[] {"CPacketInput"}, "Cancels this packet", true);
    public final Value<Boolean> CancelPosition = new Value<Boolean>("Position", new String[] {"Position"}, "Cancels this packet", true);
    public final Value<Boolean> CancelPositionRotation = new Value<Boolean>("PositionRotation", new String[] {"PositionRotation"}, "Cancels this packet", true);
    public final Value<Boolean> CancelRotation = new Value<Boolean>("Rotation", new String[] {"Rotation"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketPlayerAbilities = new Value<Boolean>("PlayerAbilities", new String[] {"CPacketPlayerAbilities"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketPlayerDigging = new Value<Boolean>("PlayerDigging", new String[] {"CPacketPlayerDigging"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketPlayerTryUseItem = new Value<Boolean>("PlayerTryUseItem", new String[] {"CPacketPlayerTryUseItem"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketPlayerTryUseItemOnBlock = new Value<Boolean>("PlayerTryUseItemOnBlock", new String[] {"CPacketPlayerTryUseItemOnBlock"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketEntityAction = new Value<Boolean>("EntityAction", new String[] {"CPacketEntityAction"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketUseEntity = new Value<Boolean>("UseEntity", new String[] {"CPacketUseEntity"}, "Cancels this packet", true);
    public final Value<Boolean> CancelCPacketVehicleMove = new Value<Boolean>("VehicleMove", new String[] {"CPacketVehicleMove"}, "Cancels this packet", true);
    
    public PacketCancellerModule()
    {
        super("PacketCanceller", new String[]
        { "PacketCanceller" }, "Packet canceller for certian packets", "NONE", 0xF20E5B, ModuleType.EXPLOIT);
    }
    
    private int PacketsCanelled = 0;
    private ArrayList<Packet> PacketsToIgnore = new ArrayList<Packet>();
    
    @Override
    public void onDisable()
    {
        super.onDisable();
        
        PacketsCanelled = 0;
    }
    
    @Override
    public String getMetaData()
    {
        return String.valueOf(PacketsCanelled);
    }

    @EventHandler
    private Listener<EventNetworkPacketEvent> PacketEvent = new Listener<>(p_Event ->
    {
        if ((p_Event.getPacket() instanceof CPacketInput && CancelCPacketInput.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayer.Position && CancelPosition.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayer.PositionRotation && CancelPositionRotation.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayer.Rotation && CancelRotation.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayerAbilities && CancelCPacketPlayerAbilities.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayerDigging && CancelCPacketPlayerDigging.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayerTryUseItem && CancelCPacketPlayerTryUseItem.getValue())
            || (p_Event.getPacket() instanceof CPacketPlayerTryUseItemOnBlock && CancelCPacketPlayerTryUseItemOnBlock.getValue())
            || (p_Event.getPacket() instanceof CPacketEntityAction && CancelCPacketEntityAction.getValue())
            || (p_Event.getPacket() instanceof CPacketUseEntity && CancelCPacketUseEntity.getValue())
            || (p_Event.getPacket() instanceof CPacketVehicleMove && CancelCPacketVehicleMove.getValue()))
        {
            if (PacketsToIgnore.contains(p_Event.getPacket()))
            {
                PacketsToIgnore.remove(p_Event.getPacket());
                return;
            }
            
            ++PacketsCanelled;
            p_Event.cancel();
            return;
        }
    });
    
    public void AddIgnorePacket(Packet p_Packet)
    {
        PacketsToIgnore.add(p_Packet);
    }
}
